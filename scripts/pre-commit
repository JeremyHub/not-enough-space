#!/bin/sh

echo "Setting up git hooks..."

cd client

echo "Linting..."
npm run lint
if [ $? -ne 0 ]; then
echo "Linting failed. Commit aborted."
exit 1
fi
echo "Checking for Prettier formatting..."
PRETTIER_CHANGED=$(npx prettier --write . 2>&1 | grep -E 'File changed')
if [ -n "$PRETTIER_CHANGED" ]; then
  echo "Prettier found unformatted files. Commit aborted."
  exit 1
fi

cd ..

cd server

echo "Running cargo clippy..."
(cargo clippy --all-targets --all-features -- -D warnings)
if [ $? -ne 0 ]; then
echo "Clippy failed. Commit aborted."
exit 1
fi

exit 0
